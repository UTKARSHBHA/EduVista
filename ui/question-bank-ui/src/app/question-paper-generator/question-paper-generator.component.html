<div class="form-container">
  <form [formGroup]="questionPaperForm" (ngSubmit)="generateQuestionPaper()">
    <!-- Standard -->
    <div class="formField">
      <label for="standard">Standard:</label>
      <ng-select
        [items]="standards"
        bindLabel="name"
        bindValue="id"
        formControlName="standard"
        (change)="onStandardSelected($event)"
        placeholder="Select Standard"
      >
      </ng-select>
    </div>
    <!-- Subject -->
    <!-- <div class="formField"> -->
    <div *ngIf="filteredSubjects.length" class="formField">
      <label for="subject">Subject:</label>
      <ng-select
        [items]="filteredSubjects"
        bindLabel="name"
        bindValue="id"
        formControlName="subject"
        (change)="onSubjectSelected($event)"
        placeholder="Select Subject"
      >
      </ng-select>
    </div>
    <!-- </div> -->
    <!-- Chapter -->
    <div *ngIf="filteredChapters.length" class="formField">
      <div class="labelSelectAll">
        <label for="chapter">Chapter:</label>
        <div>
          <input
            type="checkbox"
            [checked]="isAllTopicsSelected"
            (change)="toggleSelectAllChapters($event)"
          />
          <span> Select All </span>
        </div>
      </div>
      <ng-select
        [items]="filteredChapters"
        bindLabel="name"
        bindValue="id"
        formControlName="chapters"
        [multiple]="true"
        [closeOnSelect]="false"
        [clearable]="false"
        (change)="onChapterSelected($event)"
        placeholder="Select Chapters"
      >
      </ng-select>
    </div>
    <!-- Topic -->
    <div *ngIf="filteredTopics.length" class="formField">
      <div class="labelSelectAll">
        <label for="topic">Topic:</label>
        <div>
          <input type="checkbox" (change)="toggleSelectAllTopics($event)" />
          <span> Select All </span>
        </div>
      </div>
      <ng-select
        [items]="filteredTopics"
        bindLabel="name"
        bindValue="id"
        formControlName="topics"
        [multiple]="true"
        [closeOnSelect]="false"
        [clearable]="false"
        placeholder="Select Topics"
      >
      </ng-select>
    </div>

    <div class="formField">
      <div class="gridLabel">
        <p>Type</p>
        <p>Marks</p>
        <p>Count</p>
        <p></p>
      </div>
      <div
        formArrayName="questionsGrid"
        *ngFor="let question of questionsGrid.controls; let i = index"
      >
        <div [formGroupName]="i" class="question-row">
          <ng-select
            [items]="['mcq', 'tf', 'descriptive']"
            bindLabel="name"
            bindValue="id"
            formControlName="type"
          >
          </ng-select>
          <input
            type="number"
            formControlName="marks"
            placeholder="Marks"
            min="1"
            (ngModelChange)="updateTotalMarksAndCount()"
          />
          <input
            type="number"
            formControlName="count"
            placeholder="Count"
            min="1"
            (ngModelChange)="updateTotalMarksAndCount()"
          />
          <button (click)="removeQuestionRow(i)" class="btn">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
      <button
        (click)="addQuestionRow()"
        class="btn"
        [disabled]="questionsGrid.invalid"
      >
        <i class="fas fa-plus"></i> Add Question Type
      </button>
    </div>

    <div>
      <p>Total Marks: {{ totalMarks }}</p>
      <p>Question Count: {{ questionCount }}</p>
    </div>
    <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

    <!-- Submit Button -->
    <button type="submit" [disabled]="!questionPaperForm.valid" class="btn">
      Generate Question Paper
    </button>
  </form>
  <!-- <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div> -->

  <!-- In your question-paper-generator.component.html -->
  @if(questionPaper.length){
    <button (click)="printQuestionPaper()" class="print-btn">
      <i class="fas fa-print"></i> Print Question Paper
     </button>  

    <div *ngIf="questionPaper.length > 0" id="questionPaper">
      <h2>Question Paper</h2>

    <div *ngFor="let question of questionPaper; let i = index" class="question" >
      <p>Question {{ i + 1 }}: {{ question.question_text }}</p>
      <div class="questionMetaData" >
        <p>Type:{{ question.type }}</p>
        <p>Marks:{{ question.marks }}</p>
      </div>
      <div  
        *ngIf="question.options && question.options.length > 0"
        class="options"
      >
        <p>Options:</p>
        <ul>
          <li *ngFor="let option of question.options">{{ option.text }}</li>
        </ul>
      </div>
    </div>
  </div>

  
  }

</div>
